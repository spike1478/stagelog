<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StageLog - Theatre Performance Tracker</title>
    <link rel="stylesheet" href="styles.css?v=2.6.3">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <!-- Export/Import functionality -->
</head>
<body>
    <a class="skip-link" href="#main-content">Skip to main content</a>
    <nav class="navbar" role="navigation" aria-label="Primary">
        <div class="nav-container">
            <h1 class="nav-title">
                <i class="fas fa-theater-masks" aria-hidden="true"></i>
                StageLog
            </h1>
            <div class="nav-links">
                <button class="nav-btn active" data-page="dashboard" data-tooltip="Performance Overview">
                    <i class="fas fa-home" aria-hidden="true"></i>
                    <span>Performance Overview</span>
                </button>
                <button class="nav-btn" data-page="add-performance" data-tooltip="Add Performance">
                    <i class="fas fa-plus" aria-hidden="true"></i>
                    <span>Add Performance</span>
                </button>
                <button class="nav-btn" data-page="my-shows" data-tooltip="My Performances">
                    <i class="fas fa-list" aria-hidden="true"></i>
                    <span>My Performances</span>
                </button>
                <button class="nav-btn" data-page="analytics-enhanced" data-tooltip="Analytics">
                    <i class="fas fa-chart-line" aria-hidden="true"></i>
                    <span>Analytics</span>
                </button>
                <button class="nav-btn" data-page="access-schemes" data-tooltip="Access Schemes">
                    <i class="fas fa-universal-access" aria-hidden="true"></i>
                    <span>Access Schemes</span>
                </button>
                <button class="nav-btn" data-page="settings" data-tooltip="Settings">
                    <i class="fas fa-cog" aria-hidden="true"></i>
                    <span>Settings</span>
                </button>
                <button class="nav-btn" data-page="analytics" data-tooltip="Legacy Analytics">
                    <i class="fas fa-chart-bar" aria-hidden="true"></i>
                    <span>Legacy Analytics</span>
                </button>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode" aria-label="Toggle theme">
                <i class="fas fa-moon" id="theme-icon" aria-hidden="true"></i>
            </button>
        </div>
    </nav>

    <!-- ARIA Live Regions for Accessibility -->
    <div id="message-announcements" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    <div id="search-announcements" aria-live="polite" aria-atomic="true" class="sr-only"></div>

    <main id="main-content" class="main-content" role="main">
        <!-- Dashboard Page -->
        <div id="dashboard" class="page active">
            <div class="page-header">
                <h2>Performance Overview</h2>
                <div class="filters">
                    <input type="text" id="search-filter" placeholder="Search performances, theatres, cities...">
                    <select id="sort-filter">
                        <option value="date-desc">Date (Newest First)</option>
                        <option value="date-asc">Date (Oldest First)</option>
                        <option value="rating-desc">Rating (Highest First)</option>
                        <option value="rating-asc">Rating (Lowest First)</option>
                        <option value="title-asc">Title (A-Z)</option>
                        <option value="title-desc">Title (Z-A)</option>
                    </select>
                    <select id="city-filter">
                        <option value="">All Cities</option>
                    </select>
                    <select id="expense-filter">
                        <option value="">All Performances</option>
                        <option value="with-expenses">With Expense Data</option>
                        <option value="missing-expenses">Missing Expense Data</option>
                    </select>
                </div>
            </div>

            <!-- Quick Stats Overview -->
            <aside class="quick-stats-overview" aria-label="Performance statistics overview">
                <div class="quick-stat-card">
                    <div class="quick-stat-icon">
                        <i class="fas fa-theater-masks" aria-hidden="true"></i>
                    </div>
                    <div class="quick-stat-content">
                        <div class="quick-stat-number" id="total-performances">0</div>
                        <div class="quick-stat-label">Total Performances</div>
                    </div>
                </div>
                <div class="quick-stat-card">
                    <div class="quick-stat-icon">
                        <i class="fas fa-star" aria-hidden="true"></i>
                    </div>
                    <div class="quick-stat-content">
                        <div class="quick-stat-number" id="average-rating">0.00</div>
                        <div class="quick-stat-label">Average Rating</div>
                    </div>
                </div>
                <div class="quick-stat-card">
                    <div class="quick-stat-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="quick-stat-content">
                        <div class="quick-stat-number" id="upcoming-shows">0</div>
                        <div class="quick-stat-label">Upcoming Performances</div>
                    </div>
                </div>
                <div class="quick-stat-card">
                    <div class="quick-stat-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="quick-stat-content">
                        <div class="quick-stat-number" id="favourite-city">-</div>
                        <div class="quick-stat-label">Favourite City</div>
                    </div>
                </div>
            </aside>

            <section class="performance-sections" aria-label="Performance listings">
                <section class="performance-section" aria-labelledby="upcoming-heading">
                    <h3 id="upcoming-heading"><i class="fas fa-clock" aria-hidden="true"></i> Upcoming Performances</h3>
                    <div id="upcoming-performances" class="performance-list">
                        <!-- Upcoming performances will be populated here -->
                    </div>
                </section>

                <section class="performance-section" aria-labelledby="past-heading">
                    <h3 id="past-heading"><i class="fas fa-history" aria-hidden="true"></i> Past Performances</h3>
                    <div id="past-performances" class="performance-list">
                        <!-- Past performances will be populated here -->
                    </div>
                </section>
                </section>
        </div>

        <!-- My Performances Page -->
        <div id="my-shows" class="page">
            <div class="page-header">
                <h2>My Performances</h2>
                <p>Complete list of all your theatre performances</p>
                <div class="filters">
                    <input type="text" id="my-shows-search-filter" placeholder="Search performances, theatres, cities...">
                    <select id="my-shows-sort-filter">
                        <option value="date-desc">Date (Newest First)</option>
                        <option value="date-asc">Date (Oldest First)</option>
                        <option value="rating-desc">Rating (Highest First)</option>
                        <option value="rating-asc">Rating (Lowest First)</option>
                        <option value="title-asc">Title (A-Z)</option>
                        <option value="title-desc">Title (Z-A)</option>
                    </select>
                    <select id="my-shows-city-filter">
                        <option value="">All Cities</option>
                    </select>
                    <select id="my-shows-expense-filter">
                        <option value="">All Performances</option>
                        <option value="with-expenses">With Expense Data</option>
                        <option value="missing-expenses">Missing Expense Data</option>
                    </select>
                </div>
            </div>

            <section class="performance-sections" aria-label="All performances listing">
                <section class="performance-section" aria-labelledby="all-performances-heading">
                    <h3 id="all-performances-heading"><i class="fas fa-list" aria-hidden="true"></i> All Performances</h3>
                    <div id="my-shows-all-performances" class="performance-list">
                        <!-- All performances will be populated here -->
                    </div>
                </section>
                </section>
        </div>

        <!-- Add Performance Page -->
        <div id="add-performance" class="page">
            <div class="page-header">
                <h2>Add New Performance</h2>
            </div>

            <form id="performance-form" class="performance-form" novalidate>
                <section class="form-section" aria-labelledby="show-info-heading">
                    <h3 id="show-info-heading">Show Information</h3>
                    <div class="form-group">
                        <label for="show-search">Show Title *</label>
                        <input type="text" id="show-search" placeholder="Search for a show..." required>
                        <div id="show-suggestions" class="suggestions"></div>
                    </div>
                    <div id="show-details" class="show-details hidden">
                        <!-- Show details will be populated here -->
                    </div>
                </section>

                <section class="form-section" aria-labelledby="performance-details-heading">
                    <h3 id="performance-details-heading">Performance Details</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="date-seen">Date Seen *</label>
                            <div class="input-with-help">
                                <input type="date" id="date-seen" required aria-label="Performance date. Press Alt+Down arrow to open date picker, use arrow keys to navigate, Enter to select.">
                                <button type="button" class="help-icon" title="Keyboard shortcuts: Alt+Down to open date picker, arrow keys to navigate, Enter to select" aria-label="Date picker keyboard help">
                                    <i class="fas fa-question-circle" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="theatre-name">Theatre Name *</label>
                            <input type="text" id="theatre-name" placeholder="e.g., Vaudeville Theatre" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="city">City *</label>
                            <input type="text" id="city" placeholder="e.g., London" required>
                        </div>
                        <div class="form-group">
                            <label for="production-type">Production Type *</label>
                            <select id="production-type" required>
                                <option value="">Select...</option>
                                <option value="West End">West End</option>
                                <option value="UK Tour">UK Tour</option>
                                <option value="Broadway">Broadway</option>
                                <option value="Pro Shot">Pro Shot</option>
                                <option value="Regional">Regional</option>
                                <option value="Fringe">Fringe</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="is-musical" checked>
                                <span class="checkmark"></span>
                                This is a Musical
                            </label>
                </div>
                    </div>
                </section>

                <section class="form-section" aria-labelledby="rating-heading">
                    <h3 id="rating-heading">Rating</h3>
                    <div class="rating-grid">
                        <div class="rating-group" id="music-songs-group">
                            <label for="music-songs">Music/Songs *</label>
                            <select id="music-songs" name="music-songs">
                                <option value="">Select rating...</option>
                                <option value="0.25">0.25</option>
                                <option value="0.5">0.5</option>
                                <option value="0.75">0.75</option>
                                <option value="1">1.0</option>
                                <option value="1.25">1.25</option>
                                <option value="1.5">1.5</option>
                                <option value="1.75">1.75</option>
                                <option value="2">2.0</option>
                                <option value="2.25">2.25</option>
                                <option value="2.5">2.5</option>
                                <option value="2.75">2.75</option>
                                <option value="3">3.0</option>
                                <option value="3.25">3.25</option>
                                <option value="3.5">3.5</option>
                                <option value="3.75">3.75</option>
                                <option value="4">4.0</option>
                                <option value="4.25">4.25</option>
                                <option value="4.5">4.5</option>
                                <option value="4.75">4.75</option>
                                <option value="5">5.0</option>
                            </select>
                            <div id="music-songs-keyboard-help" class="sr-only">Keyboard shortcuts: 1-5 for quick rating, arrow keys to navigate, Home/End for min/max, Escape to clear</div>
                        </div>
                        <div class="rating-group">
                            <label for="story-plot">Story/Plot *</label>
                            <select id="story-plot" name="story-plot">
                                <option value="">Select rating...</option>
                                <option value="0.25">0.25</option>
                                <option value="0.5">0.5</option>
                                <option value="0.75">0.75</option>
                                <option value="1">1.0</option>
                                <option value="1.25">1.25</option>
                                <option value="1.5">1.5</option>
                                <option value="1.75">1.75</option>
                                <option value="2">2.0</option>
                                <option value="2.25">2.25</option>
                                <option value="2.5">2.5</option>
                                <option value="2.75">2.75</option>
                                <option value="3">3.0</option>
                                <option value="3.25">3.25</option>
                                <option value="3.5">3.5</option>
                                <option value="3.75">3.75</option>
                                <option value="4">4.0</option>
                                <option value="4.25">4.25</option>
                                <option value="4.5">4.5</option>
                                <option value="4.75">4.75</option>
                                <option value="5">5.0</option>
                            </select>
                            <div id="story-plot-keyboard-help" class="sr-only">Keyboard shortcuts: 1-5 for quick rating, arrow keys to navigate, Home/End for min/max, Escape to clear</div>
                        </div>
                        <div class="rating-group">
                            <label for="performance-cast">Performance/Cast *</label>
                            <select id="performance-cast" name="performance-cast">
                                <option value="">Select rating...</option>
                                <option value="0.25">0.25 </option>
                                <option value="0.5">0.5 </option>
                                <option value="0.75">0.75 </option>
                                <option value="1">1.0 </option>
                                <option value="1.25">1.25 </option>
                                <option value="1.5">1.5 </option>
                                <option value="1.75">1.75 </option>
                                <option value="2">2.0 </option>
                                <option value="2.25">2.25 </option>
                                <option value="2.5">2.5 </option>
                                <option value="2.75">2.75 </option>
                                <option value="3">3.0 </option>
                                <option value="3.25">3.25 </option>
                                <option value="3.5">3.5 </option>
                                <option value="3.75">3.75 </option>
                                <option value="4">4.0 </option>
                                <option value="4.25">4.25 </option>
                                <option value="4.5">4.5 </option>
                                <option value="4.75">4.75 </option>
                                <option value="5">5.0 </option>
                            </select>
                            <div id="performance-cast-keyboard-help" class="sr-only">Keyboard shortcuts: 1-5 for quick rating, arrow keys to navigate, Home/End for min/max, Escape to clear</div>
                        </div>
                        <div class="rating-group">
                            <label for="stage-visuals">Stage/Visuals *</label>
                            <select id="stage-visuals" name="stage-visuals">
                                <option value="">Select rating...</option>
                                <option value="0.25">0.25 </option>
                                <option value="0.5">0.5 </option>
                                <option value="0.75">0.75 </option>
                                <option value="1">1.0 </option>
                                <option value="1.25">1.25 </option>
                                <option value="1.5">1.5 </option>
                                <option value="1.75">1.75 </option>
                                <option value="2">2.0 </option>
                                <option value="2.25">2.25 </option>
                                <option value="2.5">2.5 </option>
                                <option value="2.75">2.75 </option>
                                <option value="3">3.0 </option>
                                <option value="3.25">3.25 </option>
                                <option value="3.5">3.5 </option>
                                <option value="3.75">3.75 </option>
                                <option value="4">4.0 </option>
                                <option value="4.25">4.25 </option>
                                <option value="4.5">4.5 </option>
                                <option value="4.75">4.75 </option>
                                <option value="5">5.0 </option>
                            </select>
                            <div id="stage-visuals-keyboard-help" class="sr-only">Keyboard shortcuts: 1-5 for quick rating, arrow keys to navigate, Home/End for min/max, Escape to clear</div>
                        </div>
                        <div class="rating-group">
                            <label for="rewatch-value">Rewatch Value *</label>
                            <select id="rewatch-value" name="rewatch-value">
                                <option value="">Select rating...</option>
                                <option value="0.25">0.25 </option>
                                <option value="0.5">0.5 </option>
                                <option value="0.75">0.75 </option>
                                <option value="1">1.0 </option>
                                <option value="1.25">1.25 </option>
                                <option value="1.5">1.5 </option>
                                <option value="1.75">1.75 </option>
                                <option value="2">2.0 </option>
                                <option value="2.25">2.25 </option>
                                <option value="2.5">2.5 </option>
                                <option value="2.75">2.75 </option>
                                <option value="3">3.0 </option>
                                <option value="3.25">3.25 </option>
                                <option value="3.5">3.5 </option>
                                <option value="3.75">3.75 </option>
                                <option value="4">4.0 </option>
                                <option value="4.25">4.25 </option>
                                <option value="4.5">4.5 </option>
                                <option value="4.75">4.75 </option>
                                <option value="5">5.0 </option>
                            </select>
                            <div id="rewatch-value-keyboard-help" class="sr-only">Keyboard shortcuts: 1-5 for quick rating, arrow keys to navigate, Home/End for min/max, Escape to clear</div>
                        </div>
                        <div class="rating-group" id="theatre-experience-group" aria-hidden="false">
                            <label for="theatre-experience">Theatre Experience</label>
                            <select id="theatre-experience" name="theatre-experience" aria-describedby="theatre-experience-description">
                                <option value="">Select rating...</option>
                                <option value="0.25">0.25 </option>
                                <option value="0.5">0.5 </option>
                                <option value="0.75">0.75 </option>
                                <option value="1">1.0 </option>
                                <option value="1.25">1.25 </option>
                                <option value="1.5">1.5 </option>
                                <option value="1.75">1.75 </option>
                                <option value="2">2.0 </option>
                                <option value="2.25">2.25 </option>
                                <option value="2.5">2.5 </option>
                                <option value="2.75">2.75 </option>
                                <option value="3">3.0 </option>
                                <option value="3.25">3.25 </option>
                                <option value="3.5">3.5 </option>
                                <option value="3.75">3.75 </option>
                                <option value="4">4.0 </option>
                                <option value="4.25">4.25 </option>
                                <option value="4.5">4.5 </option>
                                <option value="4.75">4.75 </option>
                                <option value="5">5.0 </option>
                            </select>
                            <div id="theatre-experience-description" class="sr-only">Rating for overall theatre experience including venue quality and comfort</div>
                            <div id="theatre-experience-keyboard-help" class="sr-only">Keyboard shortcuts: 1-5 for quick rating, arrow keys to navigate, Home/End for min/max, Escape to clear</div>
                        </div>
                        <div class="rating-group" id="programme-group" aria-hidden="false">
                            <label for="programme">Programme</label>
                            <select id="programme" name="programme" aria-describedby="programme-description">
                                <option value="">Select rating...</option>
                                <option value="0.25">0.25 </option>
                                <option value="0.5">0.5 </option>
                                <option value="0.75">0.75 </option>
                                <option value="1">1.0 </option>
                                <option value="1.25">1.25 </option>
                                <option value="1.5">1.5 </option>
                                <option value="1.75">1.75 </option>
                                <option value="2">2.0 </option>
                                <option value="2.25">2.25 </option>
                                <option value="2.5">2.5 </option>
                                <option value="2.75">2.75 </option>
                                <option value="3">3.0 </option>
                                <option value="3.25">3.25 </option>
                                <option value="3.5">3.5 </option>
                                <option value="3.75">3.75 </option>
                                <option value="4">4.0 </option>
                                <option value="4.25">4.25 </option>
                                <option value="4.5">4.5 </option>
                                <option value="4.75">4.75 </option>
                                <option value="5">5.0 </option>
                            </select>
                            <div id="programme-description" class="sr-only">Rating for the quality of the programme or playbill</div>
                            <div id="programme-keyboard-help" class="sr-only">Keyboard shortcuts: 1-5 for quick rating, arrow keys to navigate, Home/End for min/max, Escape to clear</div>
                        </div>
                        <div class="rating-group" id="atmosphere-group" aria-hidden="false">
                            <label for="atmosphere">Atmosphere</label>
                            <select id="atmosphere" name="atmosphere" aria-describedby="atmosphere-description">
                                <option value="">Select rating...</option>
                                <option value="0.25">0.25 </option>
                                <option value="0.5">0.5 </option>
                                <option value="0.75">0.75 </option>
                                <option value="1">1.0 </option>
                                <option value="1.25">1.25 </option>
                                <option value="1.5">1.5 </option>
                                <option value="1.75">1.75 </option>
                                <option value="2">2.0 </option>
                                <option value="2.25">2.25 </option>
                                <option value="2.5">2.5 </option>
                                <option value="2.75">2.75 </option>
                                <option value="3">3.0 </option>
                                <option value="3.25">3.25 </option>
                                <option value="3.5">3.5 </option>
                                <option value="3.75">3.75 </option>
                                <option value="4">4.0 </option>
                                <option value="4.25">4.25 </option>
                                <option value="4.5">4.5 </option>
                                <option value="4.75">4.75 </option>
                                <option value="5">5.0 </option>
                            </select>
                            <div id="atmosphere-description" class="sr-only">Rating for the general theatre atmosphere and ambiance</div>
                            <div id="atmosphere-keyboard-help" class="sr-only">Keyboard shortcuts: 1-5 for quick rating, arrow keys to navigate, Home/End for min/max, Escape to clear</div>
                        </div>
                    </div>
                </section>

                <section class="form-section" aria-labelledby="expenses-heading">
                    <h3 id="expenses-heading">Expense Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ticket-price">Ticket Price</label>
                            <input type="number" id="ticket-price" step="0.01" min="0" placeholder="e.g., 85.00">
                        </div>
                        <div class="form-group">
                            <label for="currency">Currency</label>
                            <select id="currency">
                                <option value="GBP">GBP (£)</option>
                                <option value="USD">USD ($)</option>
                                <option value="EUR">EUR (€)</option>
                                <option value="CAD">CAD ($)</option>
                                <option value="AUD">AUD ($)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="seat-location">Seat Location</label>
                            <input type="text" id="seat-location" placeholder="e.g., Stalls K12, Dress Circle B8">
                        </div>
                        <div class="form-group">
                            <label for="booking-fee">Booking Fee</label>
                            <input type="number" id="booking-fee" step="0.01" min="0" placeholder="e.g., 3.50">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="travel-cost">Travel Cost</label>
                            <input type="number" id="travel-cost" step="0.01" min="0" placeholder="e.g., 12.75">
                        </div>
                        <div class="form-group">
                            <label for="other-expenses">Other Expenses</label>
                            <input type="number" id="other-expenses" step="0.01" min="0" placeholder="e.g., 5.00 (programmes, drinks, etc.)">
                        </div>
                    </div>
                </section>

                <section class="form-section" aria-labelledby="notes-heading">
                    <h3 id="notes-heading">Notes</h3>
                    <div class="form-group">
                        <label for="notes-access">Notes on Access</label>
                        <textarea id="notes-access" placeholder="e.g., Uses In-Ear, Didn't work"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="general-notes">General Notes</label>
                        <textarea id="general-notes" placeholder="Any other comments about the performance"></textarea>
                    </div>
                </section>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="clearForm()">Clear</button>
                    <button type="submit" class="btn btn-primary">Save Performance</button>
                </div>
            </form>
        </div>

        <!-- Legacy Analytics Page -->
        <div id="analytics" class="page analytics-page">
            <div class="page-header">
                <h2>📊 Legacy Performance Analytics</h2>
                <p>Discover deep insights from your theatre journey (Legacy Version)</p>
                <div class="deprecation-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div class="warning-content">
                        <strong>⚠️ Deprecation Notice:</strong> This legacy analytics page will be removed in a future version. All data and features are being migrated to the main Analytics page. Please use the main Analytics page for the most up-to-date features and improved functionality.
                    </div>
                </div>
                <div class="analytics-controls">
                    <button class="btn btn-secondary" onclick="refreshStats()" title="Refresh analytics data">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn btn-secondary" onclick="exportStats('json')" title="Export stats as JSON">
                        <i class="fas fa-download" aria-hidden="true"></i> Export JSON
                    </button>
                
                </div>
            </div>

            <div class="analytics-container">
                <div id="analytics-live" class="sr-only" aria-live="polite"></div>
                <!-- Overview Stats -->
                <section class="stats-overview" aria-labelledby="overview-heading">
                    <div class="overview-card">
                        <h3 id="overview-heading">🎭 Overview</h3>
                        <div class="overview-stats">
                            <div class="overview-stat">
                                <div class="stat-value" id="total-shows">0</div>
                                <div class="stat-label">Total Performances</div>
                            </div>
                            <div class="overview-stat">
                                <div class="stat-value" id="total-spent">£0.00</div>
                                <div class="stat-label">Total Spent</div>
                            </div>
                            <div class="overview-stat">
                                <div class="stat-value" id="avg-rating">0.0</div>
                                <div class="stat-label">Avg Rating</div>
                            </div>
                            <div class="overview-stat">
                                <div class="stat-value" id="shows-per-month">0.0</div>
                                <div class="stat-label">Performances/Month</div>
                            </div>
                        </div>
                    </div>
                </section>

                                    <!-- Key Insights -->
                    <section class="insights-section" aria-labelledby="insights-heading">
                        <h3 id="insights-heading">💡 Key Insights</h3>
                        <div id="insights-container" class="insights-grid">
                            <!-- Insights will be populated here -->
                        </div>
                    </section>

                <!-- Achievements -->
                <section class="achievements-section" aria-labelledby="achievements-heading">
                    <h3 id="achievements-heading">🏆 Achievements</h3>
                    <div id="achievements-container" class="achievements-grid">
                        <!-- Achievements will be populated here -->
                    </div>
                </section>

                <!-- Detailed Stats Grid -->
                <section class="detailed-stats" aria-label="Detailed performance statistics">
                    <section class="stats-section" aria-labelledby="spending-analysis-heading">
                        <h3 id="spending-analysis-heading">💰 Spending Analysis</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                                <div class="stat-icon">💸</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="avg-cost">£0.00</div>
                                    <div class="stat-label">Average Cost</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">📊</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="median-cost">£0.00</div>
                                    <div class="stat-label">Median Cost</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">💎</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="max-cost">£0.00</div>
                                    <div class="stat-label">Most Expensive</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">🎯</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="min-cost">£0.00</div>
                                    <div class="stat-label">Least Expensive</div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="stats-section" aria-labelledby="cost-per-ticket-heading">
                        <h3 id="cost-per-ticket-heading">🎫 Cost Per Ticket</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">💸</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="avg-cost-per-ticket">£0.00</div>
                                    <div class="stat-label">Average Cost Per Ticket</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">📊</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="median-cost-per-ticket">£0.00</div>
                                    <div class="stat-label">Median Cost Per Ticket</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">💎</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="max-cost-per-ticket">£0.00</div>
                                    <div class="stat-label">Most Expensive Per Ticket</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">🎯</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="min-cost-per-ticket">£0.00</div>
                                    <div class="stat-label">Least Expensive Per Ticket</div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="stats-section" aria-labelledby="rating-analysis-heading">
                        <h3 id="rating-analysis-heading">⭐ Rating Analysis</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">📈</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="rating-avg">0.0</div>
                                    <div class="stat-label">Average Rating</div>
                                </div>
                    </div>
                    <div class="stat-card">
                                <div class="stat-icon">📊</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="rating-median">0.0</div>
                                    <div class="stat-label">Median Rating</div>
                                </div>
                    </div>
                    <div class="stat-card">
                                <div class="stat-icon">🎯</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="rating-percentage">0%</div>
                                    <div class="stat-label">Performances Rated</div>
                                </div>
                    </div>
                    <div class="stat-card">
                                <div class="stat-icon">⭐</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="five-stars">0</div>
                                    <div class="stat-label">5-Star Performances</div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="stats-section" aria-labelledby="venue-analysis-heading">
                        <h3 id="venue-analysis-heading">🏛️ Venue Analysis</h3>
                            <div class="venue-stats">
                                <div class="venue-summary">
                                    <div class="venue-stat">
                                        <div class="stat-number" id="total-venues">0</div>
                                        <div class="stat-label">Unique Venues</div>
                                    </div>
                                    <div class="venue-stat">
                                        <div class="stat-number" id="most-frequent-venue">-</div>
                                        <div class="stat-label">Most Visited</div>
                                    </div>
                                </div>
                                <div id="top-venues" class="top-venues-list">
                                    <!-- Top venues will be populated here -->
                                </div>
                            </div>
                        </section>

                    <section class="stats-section" aria-labelledby="performance-analysis-heading">
                        <h3 id="performance-analysis-heading">🎪 Performance Analysis</h3>
                            <div class="show-stats">
                                <div class="show-summary">
                                    <div class="show-stat">
                                        <div class="stat-number" id="unique-shows">0</div>
                                        <div class="stat-label">Unique Shows</div>
                                    </div>
                                    <div class="show-stat">
                                        <div class="stat-number" id="repeat-percentage">0%</div>
                                        <div class="stat-label">Repeat Shows</div>
                                    </div>
                                </div>
                                <div id="top-shows" class="top-shows-list">
                                    <!-- Top shows will be populated here -->
                                </div>
                            </div>
                        </section>
                </section>

                <!-- Year-over-Year Comparison -->
                <div class="comparison-section">
                    <h3>📅 Year-over-Year Comparison</h3>
                    <div class="comparison-grid">
                        <div class="comparison-card">
                            <h4>This Year</h4>
                            <div class="comparison-stats">
                                <div class="comparison-stat">
                                    <div class="stat-number" id="this-year-shows">0</div>
                                    <div class="stat-label">Performances</div>
                                </div>
                                <div class="comparison-stat">
                                    <div class="stat-number" id="this-year-spent">£0.00</div>
                                    <div class="stat-label">Spent</div>
                                </div>
                                <div class="comparison-stat">
                                    <div class="stat-number" id="this-year-rating">0.0</div>
                                    <div class="stat-label">Avg Rating</div>
                                </div>
                            </div>
                        </div>
                        <div class="comparison-card">
                            <h4>Last Year</h4>
                            <div class="comparison-stats">
                                <div class="comparison-stat">
                                    <div class="stat-number" id="last-year-shows">0</div>
                                    <div class="stat-label">Performances</div>
                                </div>
                                <div class="comparison-stat">
                                    <div class="stat-number" id="last-year-spent">£0.00</div>
                                    <div class="stat-label">Spent</div>
                                </div>
                                <div class="comparison-stat">
                                    <div class="stat-number" id="last-year-rating">0.0</div>
                                    <div class="stat-label">Avg Rating</div>
                                </div>
                            </div>
                        </div>
                        <div class="comparison-card">
                            <h4>Change</h4>
                            <div class="comparison-stats">
                                <div class="comparison-stat">
                                    <div class="stat-number" id="shows-change">0%</div>
                                    <div class="stat-label">Performances</div>
                                </div>
                                <div class="comparison-stat">
                                    <div class="stat-number" id="spending-change">0%</div>
                                    <div class="stat-label">Spending</div>
                                </div>
                                <div class="comparison-stat">
                                    <div class="stat-number" id="rating-change">0%</div>
                                    <div class="stat-label">Rating</div>
                                </div>
                        </div>
                        </div>
                    </div>
                </div>

                                    <!-- Rating Distribution -->
                    <div class="rating-distribution">
                        <h3>📊 Rating Distribution</h3>
                        <div id="rating-distribution" class="rating-bars">
                            <!-- Rating distribution will be populated here -->
                        </div>
                    </div>

                                    <!-- Price Range Analysis -->
                    <div class="price-analysis">
                        <h3>💷 Price Range Analysis</h3>
                        <div id="price-ranges" class="price-ranges-grid">
                            <!-- Price ranges will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Page -->
        <div id="analytics-enhanced" class="page analytics-page">
            <div class="page-header">
                <h2>📊 Performance Analytics</h2>
                <p>Detailed insights with separate Pro Shot and Live Performance analysis</p>
                <div class="analytics-controls">
                    <button class="btn btn-secondary" onclick="refreshEnhancedAnalytics()" title="Refresh analytics data">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn btn-secondary" onclick="exportEnhancedStats('json')" title="Export stats as JSON">
                        <i class="fas fa-download" aria-hidden="true"></i> Export JSON
                    </button>
                </div>
            </div>

            <div class="analytics-container">
                <!-- View Toggle -->
                <div class="view-toggle">
                    <button class="btn btn-primary" onclick="switchAnalyticsView('overview')" id="overview-btn">Overview</button>
                    <button class="btn btn-secondary" onclick="switchAnalyticsView('live')" id="live-btn">Live Performances</button>
                    <button class="btn btn-secondary" onclick="switchAnalyticsView('proshot')" id="proshot-btn">Pro Shots</button>
                    <button class="btn btn-secondary" onclick="switchAnalyticsView('comparison')" id="comparison-btn">Comparison</button>
                </div>

                <!-- Overview View -->
                <div id="analytics-overview" class="analytics-view">
                    <div class="enhanced-overview">
                        <div class="overview-stats">
                            <div class="overview-stat">
                                <div class="stat-value" id="enhanced-total-performances">0</div>
                                <div class="stat-label">Total Performances</div>
                            </div>
                            <div class="overview-stat">
                                <div class="stat-value" id="enhanced-live-performances">0</div>
                                <div class="stat-label">Live Performances</div>
                            </div>
                            <div class="overview-stat">
                                <div class="stat-value" id="enhanced-pro-shot-performances">0</div>
                                <div class="stat-label">Pro Shots</div>
                            </div>
                            <div class="overview-stat">
                                <div class="stat-value" id="enhanced-upcoming-performances">0</div>
                                <div class="stat-label">Upcoming</div>
                            </div>
                        </div>
                    </div>

                    <!-- Key Insights -->
                    <section class="insights-section" aria-labelledby="enhanced-insights-heading">
                        <h3 id="enhanced-insights-heading">💡 Key Insights</h3>
                        <div id="enhanced-insights-container" class="insights-grid">
                            <!-- Insights will be populated here -->
                        </div>
                    </section>

                    <!-- Achievements -->
                    <section class="achievements-section" aria-labelledby="enhanced-achievements-heading">
                        <h3 id="enhanced-achievements-heading">🏆 Achievements</h3>
                        <div id="enhanced-achievements-container" class="achievements-grid">
                            <!-- Achievements will be populated here -->
                        </div>
                    </section>
                </div>

                <!-- Live Performances View -->
                <div id="analytics-live" class="analytics-view hidden">
                    <div class="live-card">
                        <h3>🎭 Live Performances</h3>
                        <div class="live-stats">
                            <div class="live-stat">
                                <div class="stat-value" id="live-total-count">0</div>
                                <div class="stat-label">Total Live Shows</div>
                            </div>
                            <div class="live-stat">
                                <div class="stat-value" id="live-average-rating">0.0</div>
                                <div class="stat-label">Average Rating</div>
                            </div>
                            <div class="live-stat">
                                <div class="stat-value" id="live-average-cost">£0.00</div>
                                <div class="stat-label">Average Cost</div>
                            </div>
                            <div class="live-stat">
                                <div class="stat-value" id="live-total-spent">£0.00</div>
                                <div class="stat-label">Total Spent</div>
                            </div>
                        </div>
                    </div>

                    <!-- Rating Distribution -->
                    <div class="rating-distribution">
                        <h3>📊 Live Performance Rating Distribution</h3>
                        <div id="enhanced-live-rating-distribution" class="rating-bars">
                            <!-- Rating distribution will be populated here -->
                        </div>
                    </div>

                    <!-- Price Range Analysis -->
                    <div class="price-analysis">
                        <h3>💷 Live Performance Price Range Analysis</h3>
                        <div id="enhanced-live-price-ranges" class="price-ranges-grid">
                            <!-- Price ranges will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Pro Shot View -->
                <div id="analytics-proshot" class="analytics-view hidden">
                    <div class="proshot-card">
                        <div class="proshot-stats">
                            <div class="proshot-stat">
                                <div class="stat-value" id="proshot-total-count">0</div>
                                <div class="stat-label">Total Pro Shots</div>
                            </div>
                            <div class="proshot-stat">
                                <div class="stat-value" id="proshot-average-rating">0.0</div>
                                <div class="stat-label">Average Rating</div>
                            </div>
                            <div class="proshot-stat">
                                <div class="stat-value" id="proshot-best-rating">0.0</div>
                                <div class="stat-label">Best Rating</div>
                            </div>
                            <div class="proshot-stat">
                                <div class="stat-value" id="proshot-recent-count">0</div>
                                <div class="stat-label">This Year</div>
                            </div>
                        </div>
                    </div>

                    <!-- Pro Shot Rating Distribution -->
                    <div class="rating-distribution">
                        <h3>📊 Pro Shot Rating Distribution</h3>
                        <div id="enhanced-proshot-rating-distribution" class="rating-bars">
                            <!-- Rating distribution will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Comparison View -->
                <div id="analytics-comparison" class="analytics-view hidden">
                    <div class="comparison-grid">
                        <div class="comparison-card">
                            <h4>Live vs Pro Shot Comparison</h4>
                            <div class="comparison-stats">
                                <div class="comparison-stat">
                                    <div class="stat-number" id="comparison-live-count">0</div>
                                    <div class="stat-label">Live Performances</div>
                                </div>
                                <div class="comparison-stat">
                                    <div class="stat-number" id="comparison-proshot-count">0</div>
                                    <div class="stat-label">Pro Shots</div>
                                </div>
                            </div>
                        </div>
                        <div class="comparison-card">
                            <h4>Average Ratings</h4>
                            <div class="comparison-stats">
                                <div class="comparison-stat">
                                    <div class="stat-number" id="comparison-live-rating">0.0</div>
                                    <div class="stat-label">Live Average</div>
                                </div>
                                <div class="comparison-stat">
                                    <div class="stat-number" id="comparison-proshot-rating">0.0</div>
                                    <div class="stat-label">Pro Shot Average</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Year-over-Year Comparison -->
                    <div class="comparison-section">
                        <h3>📅 Year-over-Year Comparison</h3>
                        <div class="comparison-grid">
                            <div class="comparison-card">
                                <h4>This Year</h4>
                                <div class="comparison-stats">
                                    <div class="comparison-stat">
                                        <div class="stat-number" id="enhanced-this-year-shows">0</div>
                                        <div class="stat-label">Performances</div>
                                    </div>
                                    <div class="comparison-stat">
                                        <div class="stat-number" id="enhanced-this-year-spent">£0.00</div>
                                        <div class="stat-label">Spent</div>
                                    </div>
                                    <div class="comparison-stat">
                                        <div class="stat-number" id="enhanced-this-year-rating">0.0</div>
                                        <div class="stat-label">Avg Rating</div>
                                    </div>
                                </div>
                            </div>
                            <div class="comparison-card">
                                <h4>Last Year</h4>
                                <div class="comparison-stats">
                                    <div class="comparison-stat">
                                        <div class="stat-number" id="enhanced-last-year-shows">0</div>
                                        <div class="stat-label">Performances</div>
                                    </div>
                                    <div class="comparison-stat">
                                        <div class="stat-number" id="enhanced-last-year-spent">£0.00</div>
                                        <div class="stat-label">Spent</div>
                                    </div>
                                    <div class="comparison-stat">
                                        <div class="stat-number" id="enhanced-last-year-rating">0.0</div>
                                        <div class="stat-label">Avg Rating</div>
                                    </div>
                                </div>
                            </div>
                            <div class="comparison-card">
                                <h4>Change</h4>
                                <div class="comparison-stats">
                                    <div class="comparison-stat">
                                        <div class="stat-number" id="enhanced-shows-change">0%</div>
                                        <div class="stat-label">Performances</div>
                                    </div>
                                    <div class="comparison-stat">
                                        <div class="stat-number" id="enhanced-spending-change">0%</div>
                                        <div class="stat-label">Spending</div>
                                    </div>
                                    <div class="comparison-stat">
                                        <div class="stat-number" id="enhanced-rating-change">0%</div>
                                        <div class="stat-label">Rating</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Additional Analytics (Always Visible) -->
                <div class="additional-analytics">
                    <!-- Detailed Stats Grid -->
                    <section class="detailed-stats" aria-label="Detailed performance statistics">
                        <section class="stats-section" aria-labelledby="enhanced-spending-analysis-heading">
                            <h3 id="enhanced-spending-analysis-heading">💰 Live Performance Spending Analysis</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon">💸</div>
                                    <div class="stat-content">
                                        <div class="stat-number" id="enhanced-avg-cost">£0.00</div>
                                        <div class="stat-label">Average Cost</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">📊</div>
                                    <div class="stat-content">
                                        <div class="stat-number" id="enhanced-median-cost">£0.00</div>
                                        <div class="stat-label">Median Cost</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">💎</div>
                                    <div class="stat-content">
                                        <div class="stat-number" id="enhanced-max-cost">£0.00</div>
                                        <div class="stat-label">Most Expensive</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">🎯</div>
                                    <div class="stat-content">
                                        <div class="stat-number" id="enhanced-min-cost">£0.00</div>
                                        <div class="stat-label">Least Expensive</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section class="stats-section" aria-labelledby="enhanced-cost-per-ticket-heading">
                            <h3 id="enhanced-cost-per-ticket-heading">🎫 Live Performance Cost Per Ticket</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon">💸</div>
                                    <div class="stat-content">
                                        <div class="stat-number" id="enhanced-avg-cost-per-ticket">£0.00</div>
                                        <div class="stat-label">Average Cost Per Ticket</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">📊</div>
                                    <div class="stat-content">
                                        <div class="stat-number" id="enhanced-median-cost-per-ticket">£0.00</div>
                                        <div class="stat-label">Median Cost Per Ticket</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">💎</div>
                                    <div class="stat-content">
                                        <div class="stat-number" id="enhanced-max-cost-per-ticket">£0.00</div>
                                        <div class="stat-label">Most Expensive Per Ticket</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">🎯</div>
                                    <div class="stat-content">
                                        <div class="stat-number" id="enhanced-min-cost-per-ticket">£0.00</div>
                                        <div class="stat-label">Least Expensive Per Ticket</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section class="stats-section" aria-labelledby="enhanced-rating-analysis-heading">
                            <h3 id="enhanced-rating-analysis-heading">⭐ Rating Analysis</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon">📈</div>
                                    <div class="stat-content">
                                        <div class="stat-number" id="enhanced-rating-avg">0.0</div>
                                        <div class="stat-label">Average Rating</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">📊</div>
                                    <div class="stat-content">
                                        <div class="stat-number" id="enhanced-rating-median">0.0</div>
                                        <div class="stat-label">Median Rating</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">🎯</div>
                                    <div class="stat-content">
                                        <div class="stat-number" id="enhanced-rating-percentage">0%</div>
                                        <div class="stat-label">Performances Rated</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">⭐</div>
                                    <div class="stat-content">
                                        <div class="stat-number" id="enhanced-five-stars">0</div>
                                        <div class="stat-label">5-Star Performances</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section class="stats-section" aria-labelledby="enhanced-venue-analysis-heading">
                            <h3 id="enhanced-venue-analysis-heading">🏛️ Venue Analysis</h3>
                            <div class="venue-stats">
                                <div class="venue-summary">
                                    <div class="venue-stat">
                                        <div class="stat-number" id="enhanced-total-venues">0</div>
                                        <div class="stat-label">Unique Venues</div>
                                    </div>
                                    <div class="venue-stat">
                                        <div class="stat-number" id="enhanced-most-frequent-venue">-</div>
                                        <div class="stat-label">Most Visited</div>
                                    </div>
                                </div>
                                <div id="enhanced-top-venues" class="top-venues-list">
                                    <!-- Top venues will be populated here -->
                                </div>
                            </div>
                        </section>

                        <section class="stats-section" aria-labelledby="enhanced-performance-analysis-heading">
                            <h3 id="enhanced-performance-analysis-heading">🎪 Performance Analysis</h3>
                            <div class="show-stats">
                                <div class="show-summary">
                                    <div class="show-stat">
                                        <div class="stat-number" id="enhanced-unique-shows">0</div>
                                        <div class="stat-label">Unique Shows</div>
                                    </div>
                                    <div class="show-stat">
                                        <div class="stat-number" id="enhanced-repeat-percentage">0%</div>
                                        <div class="stat-label">Repeat Shows</div>
                                    </div>
                                </div>
                                <div id="enhanced-top-shows" class="top-shows-list">
                                    <!-- Top shows will be populated here -->
                                </div>
                            </div>
                        </section>
                    </section>
                </div>
            </div>
        </div>

        <!-- Access Schemes Page -->
        <div id="access-schemes" class="page" role="region" aria-labelledby="access-heading">
            <div class="page-header">
                <h2 id="access-heading">Theatre Access Schemes</h2>
                <div class="debug-shortcut-hint-main">Press <kbd>Ctrl+Shift+D</kbd> for debug tools</div>
                <div class="access-filters">
                    <input type="text" id="venue-search" placeholder="Search venues...">
                    <select id="location-filter">
                        <option value="">All Locations</option>
                    </select>
                </div>
            </div>

            <div id="access-schemes-list" class="access-schemes-list">
                <!-- Access schemes will be populated here -->
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings" class="page">
            <div class="page-header">
                <h2>Settings</h2>
                <p>Manage your data, sync settings, and application preferences</p>
            </div>

            <div class="settings-container">
                <!-- Data Management Section -->
                <section class="settings-section" aria-labelledby="data-management-heading">
                    <h3 id="data-management-heading"><i class="fas fa-database" aria-hidden="true"></i> Data Management</h3>
                    <div class="settings-grid">
                        <div class="setting-card">
                            <div class="setting-icon">
                                <i class="fas fa-download" aria-hidden="true"></i>
                            </div>
                            <div class="setting-content">
                                <h4>Export Data</h4>
                                <p>Download all your performances and access schemes as a JSON file</p>
                                <div class="setting-actions">
                                    <button class="btn btn-primary" onclick="exportDataWithFeedback()" title="Export your data as JSON">
                                        <i class="fas fa-download" aria-hidden="true"></i> Export Data
                    </button>
                                    <div class="action-feedback" id="export-feedback"></div>
                                </div>
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-icon">
                                <i class="fas fa-upload" aria-hidden="true"></i>
                            </div>
                            <div class="setting-content">
                                <h4>Restore Data</h4>
                                <p>Restore your data from a previously exported backup file</p>
                                <div class="setting-actions">
                    <button class="btn btn-secondary" onclick="showRestoreModal()" title="Restore data from backup">
                                        <i class="fas fa-upload" aria-hidden="true"></i> Restore Data
                    </button>
                                    <div class="action-feedback" id="restore-feedback"></div>
                                </div>
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-icon">
                                <i class="fas fa-file-import" aria-hidden="true"></i>
                            </div>
                            <div class="setting-content">
                                <h4>Import Data</h4>
                                <p>Import data from a JSON file (useful for testing with sample data)</p>
                                <div class="setting-actions">
                    <button class="btn btn-secondary" onclick="showImportModal()" title="Import data from JSON file">
                                        <i class="fas fa-file-import" aria-hidden="true"></i> Import JSON
                    </button>
                                    <div class="action-feedback" id="import-feedback"></div>
                                </div>
                </div>
            </div>

                        <div class="setting-card">
                            <div class="setting-icon">
                                <i class="fas fa-refresh" aria-hidden="true"></i>
                            </div>
                            <div class="setting-content">
                                <h4>Refresh Data</h4>
                                <p>Reload all data from local storage (useful if data seems out of sync)</p>
                                <div class="setting-actions">
                                    <button class="btn btn-secondary" onclick="refreshAccessDataWithFeedback()">
                                        <i class="fas fa-refresh" aria-hidden="true"></i> Refresh Data
                                    </button>
                                    <div class="action-feedback" id="refresh-feedback"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Device Sync Section -->
                <section class="settings-section" aria-labelledby="device-sync-heading">
                    <h3 id="device-sync-heading"><i class="fas fa-sync-alt" aria-hidden="true"></i> Device Sync</h3>
                    <div class="settings-grid">
                        <div class="setting-card">
                            <div class="setting-icon">
                                <i class="fas fa-sync-alt" aria-hidden="true"></i>
                            </div>
                            <div class="setting-content">
                                <h4>Device Sync</h4>
                                <p>Sync your data across multiple devices in real-time using Firebase</p>
                                <div class="sync-status-info" id="sync-status-info">
                                    <div class="sync-indicator">
                                        <i class="fas fa-circle" id="sync-status-icon" aria-hidden="true"></i>
                                        <span id="sync-status-text">Not connected</span>
                                    </div>
                                    <div class="device-count" id="device-count" style="display: none;">
                                        <i class="fas fa-users" aria-hidden="true"></i>
                                        <span id="connected-devices">0</span> devices connected
                                    </div>
                                    <div class="connected-devices-list" id="connected-devices-list" style="display: none;">
                                        <!-- Device list will be populated here -->
                                    </div>
                                </div>
                                <div class="setting-actions">
                                    <button class="btn btn-primary" onclick="showSyncModal()" title="Sync with other devices">
                                        <i class="fas fa-sync-alt" aria-hidden="true"></i> Device Sync
                                    </button>
                                    <button class="btn btn-danger" onclick="disconnectSyncFromSettings()" id="disconnect-btn" style="display: none;" title="Disconnect from sync">
                                        <i class="fas fa-times" aria-hidden="true"></i> Disconnect
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Analytics Section -->
                <section class="settings-section" aria-labelledby="analytics-settings-heading">
                    <h3 id="analytics-settings-heading"><i class="fas fa-chart-bar" aria-hidden="true"></i> Analytics</h3>
                    <div class="settings-grid">
                        <div class="setting-card">
                            <div class="setting-icon">
                                <i class="fas fa-sync-alt" aria-hidden="true"></i>
                            </div>
                            <div class="setting-content">
                                <h4>Refresh Analytics</h4>
                                <p>Update analytics data with the latest performance information</p>
                                <div class="setting-actions">
                                    <button class="btn btn-secondary" onclick="refreshStatsWithFeedback()" title="Refresh analytics data">
                                        <i class="fas fa-sync-alt" aria-hidden="true"></i> Refresh
                                    </button>
                                    <div class="action-feedback" id="analytics-refresh-feedback"></div>
                                </div>
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-icon">
                                <i class="fas fa-download" aria-hidden="true"></i>
                            </div>
                            <div class="setting-content">
                                <h4>Export Analytics</h4>
                                <p>Download analytics data as a JSON file for external analysis</p>
                                <button class="btn btn-secondary" onclick="exportStats('json')" title="Export stats as JSON">
                                    <i class="fas fa-download" aria-hidden="true"></i> Export JSON
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- App Preferences Section -->
                <section class="settings-section" aria-labelledby="app-preferences-heading">
                    <h3 id="app-preferences-heading"><i class="fas fa-cog" aria-hidden="true"></i> App Preferences</h3>
                    <div class="settings-grid">
                        <div class="setting-card">
                            <div class="setting-icon">
                                <i class="fas fa-moon" aria-hidden="true"></i>
                            </div>
                            <div class="setting-content">
                                <h4>Theme</h4>
                                <p>Switch between light and dark mode</p>
                                <button class="btn btn-secondary" onclick="toggleTheme()" title="Toggle Dark Mode">
                                    <i class="fas fa-moon" id="settings-theme-icon" aria-hidden="true"></i> Toggle Theme
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Performance Detail Modal -->
    <div id="performance-modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Performance Details</h2>
                <span class="modal-close" onclick="closePerformanceModal()">&times;</span>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Sync Modal -->
    <div id="sync-modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Device Sync</h2>
                <span class="modal-close" onclick="closeSyncModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="sync-status" class="sync-status">
                    <div class="sync-indicator">
                        <i class="fas fa-circle" id="sync-status-icon"></i>
                        <span id="sync-status-text">Connecting...</span>
                    </div>
                </div>
                
                <!-- ARIA Live Region for Sync Announcements -->
                <div id="sync-announcements" aria-live="polite" aria-atomic="true" class="sr-only"></div>
                
                <div id="sync-setup" class="sync-setup">
                    <h3>Set Up Sync</h3>
                    <p>Choose how you want to sync with other devices:</p>
                    
                    <div class="sync-options">
                        <button class="btn btn-primary" onclick="createSyncRoom()">
                            <i class="fas fa-plus" aria-hidden="true"></i> Create Sync Room
                        </button>
                        <button class="btn btn-secondary" onclick="showJoinRoom()">
                            <i class="fas fa-sign-in-alt" aria-hidden="true"></i> Join Existing Room
                        </button>
                    </div>
                </div>

                <div id="sync-room-created" class="sync-room-created hidden">
                    <h3>Sync Room Created!</h3>
                    <p>Share this code with your other devices:</p>
                    <div class="room-code">
                        <input type="text" id="room-code-display" readonly>
                        <button class="btn btn-secondary" onclick="copyRoomCode()">
                            <i class="fas fa-copy" aria-hidden="true"></i> Copy
                        </button>
                    </div>
                    <p class="sync-instructions">
                        On your other devices, open StageLog and click "Join Existing Room", then enter this code.
                    </p>
                </div>

                <div id="sync-join-room" class="sync-join-room hidden">
                    <h3>Join Sync Room</h3>
                    <p>Enter the room code from another device:</p>
                    <div class="room-code-input">
                        <input type="text" id="room-code-input" placeholder="Enter room code" maxlength="15">
                        <button class="btn btn-primary" onclick="joinSyncRoom()">
                            <i class="fas fa-sign-in-alt" aria-hidden="true"></i> Join
                        </button>
                    </div>
                </div>

                <div id="sync-active" class="sync-active hidden">
                    <h3>Sync Active</h3>
                    <p>All devices in this room are now syncing automatically!</p>
                    <div class="sync-info">
                        <p><strong>Room Code:</strong> <span id="active-room-code"></span></p>
                        <p><strong>Last Sync:</strong> <span id="last-sync-time"></span></p>
                    </div>
                    <button class="btn btn-danger" onclick="disconnectSync()">
                        <i class="fas fa-times"></i> Disconnect
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="database.js?v=2.6.3"></script>
    <script src="api.js?v=2.6.3"></script>
    <script src="csv-import.js?v=2.6.3"></script>
    <script src="import-performances.js?v=2.6.3"></script>
    <script src="musical-database.js?v=2.6.3"></script>
    <script src="restore-functions.js?v=2.6.3"></script>
    <script src="stats-system.js?v=2.6.3"></script>
    <script src="analytics-functions.js?v=2.6.3"></script>
    <script src="firebase-sync.js?v=2.6.3"></script>
    <script src="app-fixed.js?v=2.6.3"></script>
    <script src="enhanced-analytics-functions.js?v=2.6.3"></script>
    <script src="init-code.js?v=2.6.3"></script>
</body>
</html>
